<!DOCTYPE html>
<html>
<head>
    <title>three.js webgl - geometry - angle based smoothing</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <style>
        body {
            font-family: Monospace;
            background-color: #f0f0f0;
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

    <script src="../build/three.js"></script>
    <script src="js/libs/stats.min.js"></script>
    <script src="../src/extras/GeometryUtils.js"></script>
    <script>

    var camera, scene, renderer, stats;
    var geometry, material, spotLight;
    var extrudeMesh01, extrudeMesh02, extrudeMesh03;

    var extrudeSettings = {
        amount: 80,
        bevelEnabled : true,
        bevelSegments : 1,
        steps: 1,
        bevelSize: 20,
        bevelThickness: 10
    };

    init();
    animate();

    function init() {

        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
        camera.position.set(0, 0, 800);
        camera.lookAt(scene.position);



        material = new THREE.MeshLambertMaterial({color: 0xFF0000});

        var radius = 70; var sides = 16;
        var shape = _circleShape(radius, sides);

        //first of all, create a mesh without any smoothed vertex normals
        var extrudeGeo01 = new THREE.ExtrudeGeometry(shape , extrudeSettings );
        extrudeMesh01 = new THREE.Mesh(extrudeGeo01, material);
        extrudeMesh01.position.x = -300;
        scene.add(extrudeMesh01);

        //now clone the geometry and smooth the vertex normals with a 25 degrees angle, meaning that all faces
        //with an angle <= 25 degrees will be smoothed together
        var extrudeGeo02 = extrudeGeo01.clone();
        THREE.GeometryUtils.calculateVertexNormals(extrudeGeo02, 25);
        extrudeMesh02 = new THREE.Mesh(extrudeGeo02, material);
        extrudeMesh02.position.x = 0;
        scene.add(extrudeMesh02);

        //for good measure, display the catastrophic results from the ordinary "smooth everything" method
        //even with using area weighted normals
        var extrudeGeo03 = extrudeGeo01.clone();
        extrudeGeo03.computeVertexNormals(true);
        extrudeMesh03 = new THREE.Mesh(extrudeGeo03, material);
        extrudeMesh03.position.x = 300;
        scene.add(extrudeMesh03);

        spotLight = new THREE.SpotLight( 0xFFFFFF , 1.4, 100000, Math.PI, 1);
        spotLight.position.set( 500, 500, 500 );
        scene.add(spotLight);

        renderer = new THREE.WebGLRenderer( {antialias: true} );
        renderer.setSize( window.innerWidth, window.innerHeight );

        stats = new Stats();
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.top = '0px';
        document.body.appendChild( stats.domElement );

        document.body.appendChild( renderer.domElement );

    }

    function animate() {

        // note: three.js includes requestAnimationFrame shim
        requestAnimationFrame( animate );
        stats.update();

        extrudeMesh01.rotation.x += 0.01;
        extrudeMesh02.rotation.x += 0.01;
        extrudeMesh03.rotation.x += 0.01;

        renderer.render( scene, camera );

    }

    function _circleShape(radius, sides){
        if (sides < 3) {
            console.log("Error: Cylindrical Shape cannot be generated with less than 3 sides!");
        }else{
            var shape = new THREE.Shape();
            shape.moveTo(0, radius);
            for (var i = 1; i < sides; i++){
                shape.lineTo(radius * Math.sin( (i/sides)* Math.PI *2 ), radius * Math.cos((i/sides)*Math.PI * 2) );
            }
            return shape;
        }
        return undefined;
    }

</script>

</body>
</html>